## 基础数据分析集成

ClkLog 基础统计分析功能基于访问页面相关事件（如：$pageview,
$WebStay, $WebPageLoad, $WebPageLeave），从访问用户的访问渠道、访问设备、访问地域、访客类型、访问来源等维度对用户的访问量、访问次数、访问时长、访问页面深度等数据进行展示与分析，可满足基础的用户访问统计和用户画像功能。此类相关的基础数据分析的集成只需要通过神策SDK进行代码全埋点，配置埋点数据采集接收地址为ClkLog接收服务地址即可。

全埋点集成方式参考：[sdk-埋点集成参考](/integration/reference.md)

## 核心功能

> [!tip]
>**以下功能目前仅在ClkLog付费版中支持**

### 1.项目管理

ClkLog付费版支持多个项目的数据采集，各个项目采集的数据从数据的查询、统计、分析及展示层面进行的数据隔离,每个项目可以由不同的账号进行管理，每个账号可以管理查看自己权限范围内的项目的埋点数据统计。

### 2.简易用户关联集成

用户关联是为了对用户进行唯一标识，提高用户行为分析的准确性。ClkLog目前已集成了神策提供了简易用户关联。

Web JS用户登录集成方式参考神策官方集成方法，参考链接如下：

[简易用户关联（Web）](https://manual.sensorsdata.cn/sa/latest/zh_cn/web-109576379.html)

更多其他端（如Andriod、IOS、微信小程序等）用户登录集成代码接入方式请参考神策官方SDK集成文档。

### 3.事件分析集成

#### 3.1.相关名词解释

##### 3.1.1 事件相关

- ###### 1）全埋点（预置）事件

全埋点（预置）事件,是指神策 SDK 自动采集的事件，除 Web 页面浏览、Web 页面点击外还有 App 崩溃、App 激活等事件，预置事件的采集通过神策 SDK 全埋点的方式实现，详细开启或关闭方法参考神策 SDK 官方文档。

- ###### 2）预置属性

预置属性，是神策 SDK 自动采集的与预置事件属性，例如：页面路径（$url_path）、启动
场景（$scene）、屏幕宽高（$screen_height、$screen_width ）等。

神策预置事件和预置属性详细参考：[神策预置事件与预置属性](https://manual.sensorsdata.cn/sa/latest/zh_cn/tech_sdk_preset_events_and_preset_properties-7542128.html)。

- ###### 3）自定义事件

自定义事件，是根据项目在实际应用中的场景定义出来的事件，例如：商品浏览、加入购
物车、支付订单等。自定义事件的采集需要通过代码埋点的方式来实现。

- ###### 4）自定义属性

自定义属性，是自定义事件相关联的事件属性，例如：商品名称、商品价格、商品数量
等。

- ###### 5）通用预置属性

通用预置属性，是所有事件（神策预置事件和自定义事件）都有的预置属性。不同的 SDK
所对应的通用预置属性也不太一样，详情请参考神策官网。

- ###### 6）公共属性

公共属性，是所有事件（神策预置事件和自定义事件）都有的自定义属性。公共属性的采集通过自定义属性代码埋点的方式实现。

##### 3.1.2 用户相关

- ###### 1）自定义用户属性

自定义用户属性，是根据项目在实际应用中的场景定义出来的用户自定义属性，如：用户
ID，用户昵称、用户类型、注册时间等。

- ###### 2） 预置用户属性

预置用户属性，是神策 SDK 自动采集的与用户相关的属性，如国家（$country）、省份（
$province）、城市、 城市（$city）等。和预置属性、通用预置属性一样，不同 SDK 的预
置用户属性也不一样，详情请参考神策官网。

#### 3.2 事件分析介绍

ClkLog的事件分析功能主要用于除与访问页面相关的事件外的其他相关的相关事件，如$AppStart 、$AppInstall以及记录用户行为或业务过程的事件的分析。和神策事件分析一样，ClkLog将此类事件分为两种，一种是预置事件，还有一种是自定义事件。因为事件是和用户的关联性，同时ClkLog也集成了神策的用户登录和用户属性。

对于事件（预置和自定义）、事件属性（预置和自定义）、用户属性（预置和自定义）在ClkLog的数据埋点和数据采集，需要注意的是在进行代码埋点之前我们必须先根据实际业务情况定义好要采集的事件（预置和自定义）、事件属性（预置和自定义）、用户属性（预置和自定义）添加或导入【ClkLog后台】-【元数据管理】相关库，然后通过神策SDK添加相关事件及属性的的代码埋点,代码埋点集成完毕上线后在才能在ClkLog后台进行统计分析。

#### 3.3.事件分析集成步骤

##### 3.3.1.下载元数据模板

【ClkLog - 事件分析 - 元数据模板】清单如下：

- **1）Clklog - 事件分析 - 自定义事件 - 元数据模板.xlsx**

    登录【ClkLog后台】-【元数据管理】-【元事件】，点击列表上方的按钮【事件批量上传】，下载自定义事件元数据模板。

   该模板中的自定义事件及属性数据仅作参考，请根据项目实际情况去调整模板中的数据，数据项的填写请参考模板上方的提示。

- **2）Clklog - 事件分析 - 全埋点（预置）事件 - 元数据模板.xlsx**

    登录【ClkLog后台】-【元数据管理】-【元事件】，点击列表上方的按钮【事件批量上传】处，下载全埋点（预置）事件元数据模板。

   全埋点（预置）事件采集基于神策sdk，该模板仅整理神策sdk（app+webjs+微信小程序+服务端）的全埋点（预置）事件和预置属性，如需分析全埋点（预置）事件相关数据先导入该模板（导入前请根据实际引用sdk的预置事件及属性调整该模板）。

- **3）Clklog - 事件分析 - 事件（通用预置）属性 - 元数据模板.xlsx**

    登录【ClkLog后台】-【元数据管理】-【事件属性】，点击列表上方的按钮【事件属性批量上传】处，下载事件（通用预置）属性元数据模板。

   该模板仅整理神策sdk（app+webjs+微信小程序+服务端）的事件通用预置属性，如需分析事件（自定义事件+全埋点预置事件）的通用预置属性请先导入该模板（导入前请根据实际引用sdk的通用预置属性调整该模板）。

- **4）Clklog - 事件分析 - 用户（自定义）属性 - 元数据模板.xlsx**

    登录【ClkLog后台】-【元数据管理】-【用户属性】，点击列表上方的按钮【用户属性批量上传】处，下载用户（自定义）属性元数据模板。

   该模板中的自定义用户属性模板中的数据仅作参考，请根据项目实际情况去调整模板中的数据，数据项的填写请参考模板上方的提示。

- **5）Clklog - 事件分析 - 用户（预置）属性 - 元数据模板.xlsx**

    登录【ClkLog后台】-【元数据管理】-【用户属性】，点击列表上方的按钮【用户属性批量上传】处，下载用户（预置）属性元数据模板。

   该本模板整理来源于神策的通用预置用户属性，仅包含（App/Web/微信小程序）通用预置用户属性，如需分析用户预置属性相关数据先导入该模板（导入前请根据实际引用sdk的用户预置属性调整该模板）。

##### 3.3.2.设计数据采集方案

在实际应用中，需要由业务方来定义业务需要看什么数据，根据实际业务需求，抽出需要分析的业务点以及业务点需要分析的属性数据，定义好业务事件的触发时机形成数据采集方案给到研发,研发根据业务需求，按照ClkLog提供的【事件分析 - 元数据模板】整理好需要埋点采集的事件及事件属性、用户属性相关模板文件。

  **事件和属性命名规范如下：**

- **1)关于命名格式**

所有事件和属性英文明不能以数字开头，且只包含：大小写字母、数字、下划线和$。

神策的预置事件和预置属性，都以$符号开头。所有的自定义事件和属性，不能包含$符合。

自定义事件可引用同含义的预置属性的变量名，但需要使用代码埋点的方式手动传值。

- **2)中英文命名一一对应**

事件的中文名称必须和英文名称一一对应。所有的属性，包括不同事件中的属性与其英文名也必须一一对应。

- **3)属性尽量复用**

为了在性能上友好，在分析时也比较方便，当不同事件中的属性，表达的含义相同时，优先选择复用属性。

- **4)大小写不敏感**

神策的事件名和属性名大小写不敏感，但其限制方式比较特殊，即一旦有一个变量名被使用，其他和该名称仅有小大写区分的变量名就不允许创建。因此，再设计和后期维护时，需要避免此类现象发生。

如：已有app_name属性后，App_name 未key上报属性的事件就无法入库。

- **5)避免与保留属性名冲突**

为了保证查询时属性名不与系统变量名冲突，设置如下保留属性名，避免其作为自定义属性名使用：

date、datetime、distinct_id、event、events、first_id、id、original_id、device_id、properties、second_id、time、user_id、users。

##### 3.3.3.导入数据采集元数据

   登录ClkLog后台【元数据管理】，将整理好的元数据模板导入对应项目的元数据（事件、事件属性、用户属性）表中。

   **注意：**

- Ø  在ClkLog元数据表中，元数据是跟项目有关的，每个项目有自己独立的元数据定义，在导入过程中请注意确认元数据导入的项目。

- Ø  在导入过程中，建议将自定义事件、用户属性和预置事件、预置属性分开整理导入。

- Ø  属性值数据类型由首次导入时的类型决定，后续修改数据类型重新导入不会更新数据类型。

- Ø  通过事件模板导入系统后，修改导入文件里的事件英文变量名/属性英文变量名再次重新导入则会导入一个新的事件/属性名称，不会修改之前导入的事件/属性信息。

- Ø  重复多次导入事件及属性，事件/属性数据只做追加不做删除，如需删除多余事件/属性请在【ClkLog后台-元数据管理-事件/属性管理】界面做删除。

##### 3.3.4.添加事件代码埋点

###### 1) 自定义事件（代码埋点）

神策SDK 初始化后，即可以通过 **track()** 方法追踪用户行为事件，并添加自定义属性。

自定义事件, 代码参考示例：

`
sensors.track("newevent",{"prop1":"hello","prop2":"world"});
`

Web JS自定义事件代码埋点集成方式参考神策官方集成方法，参考链接如下：

[自定义事件集成文档（Web）](https://manual.sensorsdata.cn/sa/latest/zh_cn/web-7545024.html#id-%E9%9B%86%E6%88%90%E6%96%87%E6%A1%A3%EF%BC%88Web%EF%BC%89-%E4%BB%A3%E7%A0%81%E5%9F%8B%E7%82%B9%E8%BF%BD%E8%B8%AA%E4%BA%8B%E4%BB%B6)

更多其他端（如Andriod、IOS、微信小程序等）自定义事件集成代码接入方式请参考<a href="https://manual.sensorsdata.cn/sa/latest/zh_cn/tech-1573416.html"  target="satechguide">神策官方SDK集成技术指南</a>。

###### 2) 预置事件（全埋点）

预置事件是神策SDK预定义的事件，在埋点集成之前，需先在【ClkLog后台】-【元数据管理】-【元事件】，添加或导入需要集成分析的预置事件及属性信息，然后根据神策SDK相应版本的集成说明开启相关事件功能。

预置事件和预置属性说明参考神策官方文档，参考链接如下：

[神策预置事件与预置属性说明](https://manual.sensorsdata.cn/sa/latest/zh_cn/tech_sdk_preset_events_and_preset_properties-7542128.html)

各端（如Andriod、IOS、微信小程序等）预置事件开启方法请参考<a href="https://manual.sensorsdata.cn/sa/latest/zh_cn/tech-1573416.html"  target="satechguide">神策官方SDK集成技术指南</a>。

###### 3) 用户属性埋点

用户属性埋点集成之前，需先在【ClkLog后台】-【元数据管理】-【用户属性】，添加或导入用户相关属性信息，然后根据神策SDK进行用户属性集成。

预置用户属性说明参考神策官方文档，参考链接如下：
[神策预置用户属性说明](https://manual.sensorsdata.cn/sa/latest/zh_cn/tech_sdk_all_preset_properties-152305885.html#id-.%E9%A2%84%E7%BD%AE%E5%B1%9E%E6%80%A7%E6%80%BB%E8%A1%A8%E6%A0%BCv3.0-%E9%A2%84%E7%BD%AE%E7%94%A8%E6%88%B7%E5%B1%9E%E6%80%A7)

Web JS自定义事件代码埋点集成方式参考神策官方集成方法，参考链接如下：
[用户属性埋点集成文档（Web）](https://manual.sensorsdata.cn/sa/latest/zh_cn/api-web-7538088.html#id-%E5%9F%BA%E7%A1%80API%E4%BB%8B%E7%BB%8D%EF%BC%88Web%EF%BC%89-%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E5%B1%9E%E6%80%A7)

更多其他端（如Andriod、IOS、微信小程序等）用户属性集成代码接入方式请参考<a href="https://manual.sensorsdata.cn/sa/latest/zh_cn/tech-1573416.html" target="satechguide">神策官方SDK集成技术指南</a>。

###### 3) 公共属性埋点

公共属性是对于所有事件都需要添加的属性，在公共属性埋点集成之前，需先在【ClkLog后台】-【元数据管理】-事件属性，添加或导入事件的公共属性信息，然后根据神策SDK进行公共属性集成。

Web JS事件公共属性集成方式参考神策官方集成方法，参考链接如下：
[设置事件公共属性（Web）](https://manual.sensorsdata.cn/sa/latest/zh_cn/tech_sdk_client_web_api-7538088.html#id-%E5%9F%BA%E7%A1%80API%E4%BB%8B%E7%BB%8D%EF%BC%88Web%EF%BC%89-%E8%AE%BE%E7%BD%AE%E4%BA%8B%E4%BB%B6%E9%9D%99%E6%80%81%E5%85%AC%E5%85%B1%E5%B1%9E%E6%80%A7)

更多其他端（如Andriod、IOS、微信小程序等）事件公共属性集成代码接入方式请参考<a href="https://manual.sensorsdata.cn/sa/latest/zh_cn/tech-1573416.html" target="satechguide">神策官方SDK集成技术指南</a>。

#### 3.4.查看事件埋点数据采集结果

##### 1) 日志查询

事件分析相关埋点代码集成功后，在【ClkLog后台】-【事件分析】-【日志查询】查看相关事件埋点是否成功采集。

##### 2) 数据统计

事件分析相关埋点代码集成功后，在【ClkLog后台】-【事件分析】-【数据统计】查看相关事件埋点触发情况。

事件分析数据统计功能包含以下功能：

- a) 选定时间（今日/昨日/过去7天/30天/自定义）范围内的事件基础指标数据统计, 如总次数、用户数、人均次数。<br/>

- b) 按日、周、月查看指定事件的指标（总次数、用户数）的访问变化趋势以及事件触发详细日志记录。

### 4.App崩溃分析集成

按照神策SDK（Android/IOS）集成方法，开启App崩溃事件（AppCrash）后, clklog-receiver服务即可采集崩溃相关数据，然后在【App崩溃分析】功能中对崩溃数据及日志进行查询分析。
